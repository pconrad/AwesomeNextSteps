<!doctype html>
<html>

<!-- Authors: Phill Conrad, Evan Crook, Kevin Malta, and the students of CCS CS 130E, Spring 2014-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>The Beginning of the Next Steps of Project Awesome</title>
    <script src="../js/bits.js"></script>
    <script src="../js/random.js"></script>
    <script src="../js/questions.js"></script>    
    <script src="../js/questions/orderOfOperations.js"></script>
    <script src="../js/questions/changeOfBase.js"></script>
    <script src="../js/questions/operandsAndOperators.js"></script>
    <script src="../js/questions/pythonProgramOutput.js"></script>
    <script src="../js/questions/pythonStringSlice.js"></script>
    <script src="../js/questions/symbolicLogic.js"></script>
    <script src="../js/questions/CvariableType.js"></script>
    <script src="../js/questions/strings.js"></script>
    <script src="../purl/purl.js"></script>
    <script src="../js/parser.js"></script>
</head>

<body>

    <div id="seed"></div>
    <div id="questions">
		<p>Click the "Load JSON" button to load a JSON file from the local machine
		specifying the question types to include, in what order, how many, etc. <br>
		This page should then disappear and be replaced with the quiz. <br> <br> </p>	
		
		<p>Enter a seed (in hexadecimal) for the quiz below. <br>
		(If none is provided, one will be randomly generated.) <br>
		Seed: <input type="text" id="seedInput"> </p> <br>

		<br>
		<button type="button" onclick="loadJSON()">Load JSON</button>
	</div>
    <div id="answers"></div>   
	
    <script>
		//Whee I get to play with AJAX
		//I think jQuery can do this better but I don't know it -- yet. also there's some value in understanding the old ways of things
	
		//Load a JSON file from the local machine containing a quiz specification
		function loadJSON()
		{		
			var seed = parseInt(document.getElementById("seedInput").value,16);
			seed = isNaN(seed) ? (Math.floor(Math.random() * 0xFFFFFFFF)) : seed;

			var randomStream = new RandomStream(seed);
		
			var jsonFile = "../quiz.json";
			var httpRequest = new XMLHttpRequest(); //because screw IE	
			
			httpRequest.onreadystatechange = function()
			{
				if(httpRequest.readyState == 4 && httpRequest.status == 200)
				{
					//Parse the JSON data that should be in the response text, turn it into an actual Javascript object (or in this case an array)
					var quizJSON = JSON.parse(httpRequest.responseText);
				
					//Call the parser on it -- which will return an array of question objects
					var questions = parseQuizJSON(quizJSON.quiz, randomStream);
				
					//Create a string that is a list of all the questions
					var questionsText = "";
					for(var i=0; i<questions.length; i++)
					    questionsText += "<h3>Question " + (i+1) + ":</h3>" + questions[i].formatQuestion("HTML") + "<br>";

					//Create a string that is a list of all the answers
					var answersText = "";
					for(var i=0; i<questions.length; i++)
					    answersText += "<strong>" + (i+1) + ") </strong>" + questions[i].formatAnswer("HTML") + "<br>";
						
					//Store the answers text so answers.html can retrieve it
					localStorage.setItem("answers",answersText);
					localStorage.setItem("seed",seed.toString(16).toUpperCase());
					
					//Update the document (should be using jquery!)
					document.getElementById("questions").innerHTML = questionsText;
					document.getElementById("seed").innerHTML = "<h3>Seed: " + seed.toString(16).toUpperCase() + "</h3> <hr> <br>";
					document.getElementById("answers").innerHTML = "<a href=\"./answers.html\" target=\"_blank\">Answer Key</a>"	
					
				}
			}
			
			httpRequest.open("GET", jsonFile, true);
			httpRequest.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
			httpRequest.send();
		}
	</script>	
		
</body>

</html>
